name: PIG 镜像 action

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Set up variables
        id: vars
        run: |
          echo "::set-output name=IMAGE_NAME::mysql/mysql-server"
          echo "::set-output name=NEW_NAME::mysql-server"
          echo "::set-output name=IMAGE_VERSION::8.0.32"
          echo "::set-output name=TARGET_REGISTRY::registry.cn-hangzhou.aliyuncs.com"
          echo "::set-output name=TARGET_REPOSITORY::dockerhub_mirror"
        shell: bash

      - name: Login to Docker Registry
        run: docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }} ${{ steps.vars.outputs.TARGET_REGISTRY }}

      - name: Pull, tag, and push Docker image
        run: |
          docker pull ${{ steps.vars.outputs.IMAGE_NAME }}:${{ steps.vars.outputs.IMAGE_VERSION }}
          docker tag ${{ steps.vars.outputs.IMAGE_NAME }}:${{ steps.vars.outputs.IMAGE_VERSION }} ${{ steps.vars.outputs.TARGET_REGISTRY }}/${{ steps.vars.outputs.TARGET_REPOSITORY }}/${{ steps.vars.outputs.NEW_NAME }}:${{ steps.vars.outputs.IMAGE_VERSION }}
          docker push ${{ steps.vars.outputs.TARGET_REGISTRY }}/${{ steps.vars.outputs.TARGET_REPOSITORY }}/${{ steps.vars.outputs.NEW_NAME }}:${{ steps.vars.outputs.IMAGE_VERSION }}
